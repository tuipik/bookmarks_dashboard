services:
  web:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: start-dashboard-prod
    command: >
      sh -c "alembic upgrade head &&
             gunicorn --bind 0.0.0.0:8000 --workers 2 --threads 4 --timeout 60 wsgi:app"
    ports:
      - "8888:8000"
    environment:
      APP_ENV: production
      SECRET_KEY: change-me-in-production
      RATELIMIT_STORAGE_URI: memory://
      DB_PATH: /app/data/data.db
      SQLALCHEMY_DATABASE_URI: sqlite:////app/data/data.db
      UPLOAD_DIR: /app/static/uploads
    restart: unless-stopped
    volumes:
      - ./storage:/app/data
      - app_uploads_prod:/app/static/uploads

volumes:
  app_uploads_prod:
